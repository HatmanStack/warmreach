<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'unsafe-inline'">
  <title>WarmReach Agent Settings</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      background: #f8f9fa;
      color: #1a1a1a;
      font-size: 13px;
    }
    h2 { font-size: 15px; margin-bottom: 12px; color: #333; }
    .field { margin-bottom: 10px; }
    label { display: block; margin-bottom: 3px; font-weight: 500; color: #555; }
    input {
      width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px;
      font-size: 13px; background: #fff;
    }
    input:focus { outline: none; border-color: #4a90d9; }
    .actions { margin-top: 14px; display: flex; gap: 8px; }
    button {
      padding: 6px 14px; border: 1px solid #ccc; border-radius: 4px;
      font-size: 13px; cursor: pointer; background: #fff;
    }
    button.primary { background: #4a90d9; color: #fff; border-color: #4a90d9; }
    button.danger { color: #d9534f; border-color: #d9534f; }
    .status { margin-top: 10px; font-size: 12px; color: #666; min-height: 16px; }
    .status.ok { color: #5cb85c; }
    .status.err { color: #d9534f; }
    hr { border: none; border-top: 1px solid #ddd; margin: 16px 0; }
  </style>
</head>
<body>
  <h2>LinkedIn Credentials</h2>
  <div class="field">
    <label for="email">Email</label>
    <input type="email" id="email" placeholder="your@email.com" autocomplete="off">
  </div>
  <div class="field">
    <label for="password">Password</label>
    <input type="password" id="password" placeholder="LinkedIn password" autocomplete="off">
  </div>
  <div class="actions">
    <button class="primary" id="save-creds">Save</button>
    <button class="danger" id="clear-creds">Clear</button>
  </div>
  <div class="status" id="cred-status"></div>

  <hr>

  <h2>WebSocket URL</h2>
  <div class="field">
    <label for="ws-url">Backend WebSocket URL</label>
    <input type="url" id="ws-url" placeholder="wss://..." autocomplete="off">
  </div>
  <div class="actions">
    <button class="primary" id="save-ws">Save</button>
  </div>
  <div class="status" id="ws-status"></div>

  <script>
    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    const wsUrlEl = document.getElementById('ws-url');
    const credStatus = document.getElementById('cred-status');
    const wsStatus = document.getElementById('ws-status');

    function showStatus(el, msg, ok) {
      el.textContent = msg;
      el.className = 'status ' + (ok ? 'ok' : 'err');
      setTimeout(() => { el.textContent = ''; el.className = 'status'; }, 3000);
    }

    // Load existing values
    window.settingsAPI.getCredentials().then((creds) => {
      if (creds) {
        emailEl.value = creds.email || '';
        passwordEl.placeholder = creds.email ? '(stored)' : 'LinkedIn password';
      }
    });
    window.settingsAPI.getWsUrl().then((url) => {
      if (url) wsUrlEl.value = url;
    });

    document.getElementById('save-creds').addEventListener('click', async () => {
      const email = emailEl.value.trim();
      const password = passwordEl.value;
      if (!email || !password) {
        showStatus(credStatus, 'Email and password required', false);
        return;
      }
      await window.settingsAPI.saveCredentials(email, password);
      passwordEl.value = '';
      passwordEl.placeholder = '(stored)';
      showStatus(credStatus, 'Credentials saved', true);
    });

    document.getElementById('clear-creds').addEventListener('click', async () => {
      await window.settingsAPI.clearCredentials();
      emailEl.value = '';
      passwordEl.value = '';
      passwordEl.placeholder = 'LinkedIn password';
      showStatus(credStatus, 'Credentials cleared', true);
    });

    document.getElementById('save-ws').addEventListener('click', async () => {
      const url = wsUrlEl.value.trim();
      if (!url) {
        showStatus(wsStatus, 'URL required', false);
        return;
      }
      await window.settingsAPI.saveWsUrl(url);
      showStatus(wsStatus, 'URL saved (restart to reconnect)', true);
    });
  </script>
</body>
</html>
